!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t){e.exports='<div class="m-entitygeometry-container">\n    <div id="m-button-entitypolygon-vertical" class="m-control button">\n        \x3c!--<button id="m-addtosandbox-button" class="g-cartografia-capas" title="Añadir geometrías a la capa de trabajo"></button> --\x3e\n        <button id="m-addgeometry-button" class="icon-edition-import-button" title="Importar geometría desde capa vectorial"></button>\n        <div id="m-selectmenu-button" class="dropdown-edition">\n            <button id="m-select-button" class="g-cartografia-flecha" title="Seleccionar"></button>\n            <div id="myDropdown" class="dropdown-edition-content">\n                <div><button id="m-selectclick-button" class="icon-edition-select-click" title="Seleccionar por click"></button></div>\n                <div><button id="m-selectline-button" class="icon-edition-select-line" title="Seleccionar por línea"></button></div>\n                <div><button id="m-selectarea-button" class="icon-edition-select-area" title="Seleccionar por área"></button></div>\n                <div><button id="m-selectall-button" class="icon-edition-select-all" title="Seleccionar todas las geometrías"></button></div>\n                <div><button id="m-deselectall-button" class="icon-edition-deselect-all" title="Deseleccionar todas las geometrías"></button></div>\n            </div>\n        </div>\n        <div id="m-zoommenu-button" class="dropdown-edition">\n            <button id="m-zoom-button" class="g-cartografia-zoom" title="Zoom"></button>\n            <div id="myDropdown-edition" class="dropdown-edition-content">\n                <div><button id="m-zoomsandbox-button" class="icon-edition-zoom-sandbox" title="Zoom a la capa de trabajo"></button></div>\n                <div><button id="m-zoomselect-button" class="icon-edition-zoom-selection" title="Zoom a las geometrías seleccionadas"></button></div>\n            </div>\n        </div>\n        <button id="m-draw-button" class="g-cartografia-editar" title="Dibujar geometría"></button>\n        <button id="m-snapping-button" class="icon-edition-snapping" title="Activar snapping"></button>\n        <button id="m-modify-button" class="icon-edition-modify-polygon" title="Modificar geometría"></button>\n        <button id="m-splitpolygon-button" class="g-cartografia-linea" title="Dividir geometría"></button>\n        <button id="m-unir-button" class="icon-edition-union" title="Agrupar geometrías"></button>\n        <button id="m-vaciado-button" class="icon-edition-empty-polygon" title="Vaciado"></button>\n        <button id="m-intersect-button" class="icon-edition-intersection" title="Intersección de geometrías"></button>\n        <button id="m-removefromsandbox-button" class="icon-edition-delete-selected" title="Eliminar geometrías seleccionadas de la capa de trabajo"></button>\n    </div>\n</div>'},function(e,t){e.exports='<div class="m-dialog {{severity}}">\n   <div class="m-modal">\n      <div class="m-content">\n         <div class="m-title">\n            <i class="m-icon"></i>\n            <span>{{{title}}}</span>\n         </div>\n         <div class="m-message">{{{message}}}\n            {{#if layers}}\n            <br>\n            <select class="m-layer-selection">\n               {{#each layers}}\n               <option value="{{{this.name}}}">{{this.name}}</option>\n               {{/each}}\n             </select> \n             {{/if}}\n         </div>\n         <div id="m-edition-dialog-button-aceptar" class="m-edition-dialog-button">\n            <button>Aceptar</button>\n         </div>\n         <div id="m-edition-dialog-button-cancelar" class="m-edition-dialog-button">\n            <button>Cancelar</button>\n         </div>\n      </div>\n   </div>\n</div>'},function(e){e.exports=JSON.parse('{"url":{"name":"edition","separator":"*"},"constructor":"M.plugin.Edition","parameters":[],"files":{"ol":{"scripts":["edition.ol.min.js"],"styles":["edition.ol.min.css"]}},"metadata":{"name":"Edition","description":"Edición de geoprocesos","text":"Plugin que permite editar capas existentes en el mapa, o creadas por el propio usuario","version":"1.0.0","date":"Marzo 2020","author":"","org":"","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","centralized":true}}')},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(3);var o=n(0),r=n.n(o);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=l(this,s(t).call(this))).base_=e,n.map_=e.facadeMap_,n.ol3Layer_=null,n.isVisible_=!0,n.isModified_=!1,n.sandBoxFeatures_=[],n.sandBoxLayer_=null,n.selectedFeatures_=[],n.deletedFeatures_=[],n.geometry=void 0,n.type_="MultiPolygon",n.addTo(n.map_),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,M.impl.Layer),n=t,(o=[{key:"addTo",value:function(){this.sandBoxLayer_=new M.layer.Vector,this.sandBoxLayer_.name="editionLayer",this.sandBoxLayer_.setZIndex(M.impl.Map.Z_INDEX[M.layer.type.WFS]+999),this.map_.addLayers(this.sandBoxLayer_),this.ol3Layer_=this.sandBoxLayer_.getImpl().getOL3Layer(),this.ol3Layer_.setStyle(this.selectableStyle(this.getSandBoxStyle())),this.sandBoxLayer_.setStyle(new M.style.Polygon({fill:{color:"red",opacity:.5},stroke:{color:"#FF0000",width:2}})),this.setVisible(!0)}},{key:"setStyle",value:function(e){this.sandBoxLayer_.setStyle(e)}},{key:"selectableStyle",value:function(e){var t=this;return function(){return null===t.base_.highlightControl.getImpl().highlightInteraction_||-1==t.base_.highlightControl.getImpl().highlightInteraction_.getFeatures().getArray().indexOf(this)?e:t.base_.highlightControl.getImpl().highlightStyle}}},{key:"getType",value:function(){return this.type_}},{key:"setType",value:function(e){this.type_=e,"MultiPoint"===e||"Point"===e?this.sandBoxLayer_.setStyle(new M.style.Point({radius:5,fill:{color:"red",opacity:.5},stroke:{color:"#FF0000"}})):"MultiPolygon"!==e&&"Polygon"!==e||this.sandBoxLayer_.setStyle(new M.style.Polygon({fill:{color:"red",opacity:.5},stroke:{color:"#FF0000",width:2}}))}},{key:"getImplLayer",value:function(){return this.ol3Layer_}},{key:"getImplFeature",value:function(e){return e.getImpl().getOLFeature()}},{key:"getFeatureCollectionById",value:function(e){for(var t=this.ol3Layer_.getSource().getFeatures(),n=0;n<t.length;n++)if(t[n].getId()===e)return new ol.Collection([t[n]])}},{key:"getFeatureCollection",value:function(){var e=this.ol3Layer_.getSource().getFeatures();return new ol.Collection([e])}},{key:"getSelectedFeatureCollection",value:function(){for(var e=[],t=0;t<this.selectedFeatures_.length;t++)e.push(this.selectedFeatures_[t].getImpl().getOLFeature());return new ol.Collection(e)}},{key:"getOLFeatures",value:function(){return this.ol3Layer_.getSource().getFeatures()}},{key:"getFeatures",value:function(){return this.sandBoxLayer_.getFeatures()}},{key:"addFeatures",value:function(e){return console.log("addFeatures"),this.sandBoxLayer_.addFeatures(e)}},{key:"hasGeometry",value:function(){return this.ol3Layer_.getSource().getFeatures().length>0}},{key:"getGeometry",value:function(){return this.geometry}},{key:"getCoordinatesFromFeature",value:function(e){return e.getGeometry().getCoordinates()}},{key:"getCoordinatesFromFeatureById",value:function(e){var t=this.getFeatureById(e);return null!==t?t.getGeometry().getCoordinates():null}},{key:"readGML3Features",value:function(e){var t=new ol.proj.Projection({code:"http://www.opengis.net/gml/srs/epsg.xml#25830",axis:"enu"});return ol.proj.addEquivalentProjections([ol.proj.get(this.map_.getProjection().code),t]),(new ol.format.GML3).readFeatures(e,this.map_.getProjection())}},{key:"addFeature",value:function(e){var t=(new ol.format.GeoJSON).writeFeatureObject(e),n=new M.Feature(e.getId(),t);return this.sandBoxLayer_.addFeatures(n),n}},{key:"removeFeatureById",value:function(e){var t=this.sandBoxLayer_.getFeatureById(e);return void 0!==t&&(this.sandBoxFeatures_=[],this.selectedFeatures_=[],this.sandBoxLayer_.removeFeatures([t]),this.deletedFeatures_.push(t),this.isModified_=!0,[t.getId()])}},{key:"removeFeature",value:function(e){var t=this;this.sandBoxLayer_.getFeatures().forEach((function(n){n===e&&t.sandBoxLayer_.removeFeatures([n])}))}},{key:"removeAllFeatures",value:function(){var e=this.sandBoxLayer_.getFeatures();return this.sandBoxLayer_.removeFeatures(e),Array.prototype.push.apply(this.deletedFeatures_,e),this.sandBoxFeatures_=[],this.selectedFeatures_=[],this.isModified_=!0,!0}},{key:"addFeaturesToSandBox",value:function(e){var t=this;e.forEach((function(e,n,o){for(var r=!1,i=0;i<t.sandBoxLayer_.getFeatures().length;i++)if(t.sandBoxLayer_.getFeatures()[i].getImpl().getId()===Number(e.id)){r=!0;break}if(!r){var a={type:"Feature",geometry:{type:e.type,coordinates:e.coordinates}},l=new M.Feature(e.id,a);t.sandBoxLayer_.addFeatures(l)}}))}},{key:"addNewFeatureToSandBox",value:function(e){console.log("addNewFeatureToSandBox");var t=(new ol.format.GeoJSON).writeFeatureObject(e),n=new M.Feature(e.getId(),t);console.log("Añadiendo el feature: ",n),this.sandBoxLayer_.addFeatures(n)}},{key:"addNewMFeatureToSandBox",value:function(e){this.sandBoxLayer_.addFeatures(e)}},{key:"removeFeaturesFromSandBox",value:function(e){for(var t=e.length;t--;){var n=this.sandBoxLayer_.getFeatureById(e[t].getId());void 0!==n&&(n instanceof M.Feature?this.unselectFeature(n.getImpl().getOLFeature()):this.unselectFeature(n),this.sandBoxLayer_.removeFeatures(n))}}},{key:"selectFeature",value:function(e){var t=this.sandBoxLayer_.getFeatureById(e.getId());void 0!==t&&(t.getImpl().getOLFeature().setStyle(this.selectableStyle(this.getSelectedStyle())),this.selectedFeatures_.push(t))}},{key:"unselectFeature",value:function(e){for(var t=this.selectedFeatures_.length;t--;)this.selectedFeatures_[t].getImpl().getOLFeature().getId()===e.getId()&&(this.selectedFeatures_[t].getImpl().getOLFeature().setStyle(this.selectableStyle(this.getSandBoxStyle())),this.selectedFeatures_.splice(t,1))}},{key:"selectAllFeatures",value:function(){for(var e=this.sandBoxLayer_.getFeatures(),t=0;t<e.length;t++)this.selectedFeatures_.length>0?-1===this.selectedFeatures_.indexOf(e[t])&&this.selectFeature(e[t]):this.selectFeature(e[t])}},{key:"unselectAllFeatures",value:function(){for(var e=this.sandBoxLayer_.getFeatures(),t=0;t<e.length;t++)e[t].getImpl().getOLFeature().setStyle(this.selectableStyle(this.getSandBoxStyle()));this.selectedFeatures_=[]}},{key:"getGeometriesExtension",value:function(){var e=this.ol3Layer_.getSource().getFeatures(),t=new ol.extent.createEmpty;return e.forEach((function(e,n,o){ol.extent.extend(t,e.getGeometry().getExtent())})),t}},{key:"getOLFeaturesExtensionByAttribute",value:function(e,t){for(var n=[],o=0;o<e.length;o++){var r=this.getOLFeatureByUniqueAttribute(Number(e[o]),t);n.push(r)}var i=new ol.extent.createEmpty;return n.forEach((function(e,t,n){null!==e&&ol.extent.extend(i,e.getGeometry().getExtent())})),i}},{key:"getOLFeaturesExtension",value:function(e){for(var t=[],n=0;n<e.length;n++){var o=e[n].getImpl().getOLFeature();t.push(o)}var r=new ol.extent.createEmpty;return t.forEach((function(e,t,n){null!==e&&ol.extent.extend(r,e.getGeometry().getExtent())})),r}},{key:"zoomToLayer",value:function(){if(this.ol3Layer_.getSource().getFeatures().length>0){var e=this.ol3Layer_.getSource().getFeatures(),t=new ol.extent.createEmpty;e.forEach((function(e){ol.extent.extend(t,e.getGeometry().getExtent())})),this.map_.getMapImpl().getView().fit(t,{duration:500})}}},{key:"zoomToFeatures",value:function(e){try{var t=M.impl.utils.getFeaturesExtent(e);this.map_.setBbox(t)}catch(e){M.dialog.info("No existe ninguna geometría asociada")}}},{key:"zoomToFeaturesByIdsArray",value:function(e,t){try{var n=this.getOLFeaturesExtensionByAttribute(e,t);this.map_.getMapImpl().getView().fit(n,{maxZoom:12,duration:500})}catch(e){M.dialog.info("No existe ninguna geometría asociada")}}},{key:"zoomToFeatureById",value:function(e){var t=this.getFeatureById(e);if(null!==t){var n=new ol.extent.createEmpty;ol.extent.extend(n,t.getGeometry().getExtent()),this.map_.getMapImpl().getView().fit(n,{maxZoom:12,duration:500})}}},{key:"getMFeatureByUniqueAttribute",value:function(e,t){for(var n=this.sandBoxLayer_.getFeatures(),o=0;o<n.length;o++)if(n[o].getAttribute(t)===e)return n[o]}},{key:"getFeatureById",value:function(e){var t=null;return this.ol3Layer_.getSource().getFeatures().length>0&&this.ol3Layer_.getSource().getFeatures().forEach((function(n,o,r){if(n.getId()===e)return t=n,!0})),t}},{key:"getMFeatureById",value:function(e){return this.sandBoxLayer_.getFeatureById(e)}},{key:"getOLFeatureByUniqueAttribute",value:function(e,t){var n=null;return this.ol3Layer_.getSource().getFeatures().length>0&&this.ol3Layer_.getSource().getFeatures().forEach((function(o,r,i){if(o.get(t)===e)return n=o,!0})),n}},{key:"getDeletedFeatures",value:function(){return this.deletedFeatures_}},{key:"clearDeletedFeaturesArray",value:function(){this.deletedFeatures_=[]}},{key:"rollbackFeatures",value:function(e){this.ol3Layer_.getSource().addFeatures(e)}},{key:"clear",value:function(){this.ol3Layer_.getSource().clear()}},{key:"refresh",value:function(){this.ol3Layer_.getSource().refresh()}},{key:"destroy",value:function(){var e=this.map_.getMapImpl();M.utils.isNullOrEmpty(this.ol3Layer_)||(e.removeLayer(this.ol3Layer_),this.ol3Layer_=null),this.map_.removeLayers(this.sandBoxLayer_),this.map_=null,this.popup_=null,this.sandBoxFeatures_=[],this.name=null}},{key:"getSandBoxStyle",value:function(){return new ol.style.Style({fill:new ol.style.Fill({color:[93,95,229,.2]}),stroke:new ol.style.Stroke({color:"blue",width:2})})}},{key:"getSelectedStyle",value:function(){return new ol.style.Style({fill:new ol.style.Fill({color:[249,232,6,.1]}),stroke:new ol.style.Stroke({color:"yellow",width:2})})}}])&&a(n.prototype,o),r&&a(n,r),t}();function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function d(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e,t,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(e,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=d(this,h(t).call(this))).layer_=n,o.modifiedFeatures=[],o.interactions_=[],o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,M.impl.Control),n=t,(o=[{key:"addTo",value:function(e,n){p(h(t.prototype),"addTo",this).call(this,e,n)}},{key:"activate",value:function(e,t,n){if(console.log("Activando editionFeometryBase"),this.interactions_.length<1){this.createInteraction(e,t,n);for(var o=0;o<this.interactions_.length;o++)this.layer_.map_.getMapImpl().addInteraction(this.interactions_[o])}for(var r=0;r<this.layer_.map_.getControls().length;r++)this.layer_.map_.getControls()[r].activated&&this.layer_.map_.getControls()[r].deactivate();for(var i=0;i<this.interactions_.length;i++)this.interactions_[i].setActive(!0)}},{key:"deactivate",value:function(){if(this.interactions_.length>0){for(var e=0;e<this.interactions_.length;e++)this.interactions_[e].setActive(!1),this.layer_.map_.getMapImpl().removeInteraction(this.interactions_[e]);this.interactions_=[]}}},{key:"destroy",value:function(){this.layer_.map_.getMapImpl().removeControl(this),this.layer_=null,this.interactions_=[],this.modifiedFeatures=null}}])&&f(n.prototype,o),r&&f(n,r),t}();function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=function(e){function t(e,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=_(this,w(t).call(this,e,n))).map_=e,o.selectInteraction_=null,o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,e),n=t,(o=[{key:"createInteraction",value:function(e,t){this.selectInteraction_=new ol.interaction.Select({layers:[this.layer_.sandBoxLayer_.getImpl().getOL3Layer()],multi:!0,condition:ol.events.condition.click}),this.selectInteraction_.on("select",e,this),this.interactions_.push(this.selectInteraction_)}}])&&b(n.prototype,o),r&&b(n,r),t}(m);function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function L(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var x=function(e){function t(e,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(P)&&M.exception("La implementación usada no puede crear controles EditionSelectGeometry");var r=new P(e,n);return(o=L(this,k(t).call(this,r,"editionSelectGeometry"))).name="editionSelectGeometry",o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(t,M.Control),n=t,(o=[{key:"activate",value:function(e,t){this.getImpl().activate(e,t),this.activated=!0}},{key:"equals",value:function(e){return e instanceof M.control.EditionSelectGeometry}},{key:"setLayer",value:function(e){console.log("seteando layer_"),this.getImpl().layer_=e}}])&&F(n.prototype,o),r&&F(n,r),t}();function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function j(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function I(e,t,n){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),j(this,T(t).call(this))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(t,M.impl.Control),n=t,(o=[{key:"addTo",value:function(e,n){var o=this;e.getMapImpl().getInteractions().forEach((function(e){e instanceof ol.interaction.DoubleClickZoom&&(o.dblClickInteraction_=e)})),I(T(t.prototype),"addTo",this).call(this,e,n)}},{key:"activateClick",value:function(e){this.dblClickInteraction_.setActive(!1),e.getMapImpl().on("dblclick",(function(t){var n=new CustomEvent("mapclicked",{detail:t.coordinate,bubbles:!0});e.getContainer().dispatchEvent(n)}))}},{key:"deactivateClick",value:function(e){this.dblClickInteraction_.setActive(!0),e.getMapImpl().removeEventListener("dblclick")}}])&&E(n.prototype,o),r&&E(n,r),t}();function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function A(e,t){return!t||"object"!==D(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var J=function(e){function t(e,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=A(this,q(t).call(this,e,n))).map_=e,o.highlightInteraction_=null,o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,e),n=t,(o=[{key:"createInteraction",value:function(e,t){this.highlightStyle=[new ol.style.Style({fill:new ol.style.Fill({color:[249,177,10,.2]})}),new ol.style.Style({stroke:new ol.style.Stroke({color:"orange",width:2.5})})],this.highlightInteraction_=new ol.interaction.Select({layers:[this.layer_.sandBoxLayer_.getImpl().getOL3Layer()],condition:ol.events.condition.pointerMove,style:this.highlightStyle}),this.interactions_.push(this.highlightInteraction_)}}])&&z(n.prototype,o),r&&z(n,r),t}(m);function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function U(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var X=function(e){function t(e,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(J)&&M.exception("La implementación usada no puede crear controles EditionHighlightGeometry");var r=new J(e,n);return(o=U(this,Z(t).call(this,r,"editionHighlightGeometry"))).name="editionHighlightGeometry",o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(t,M.Control),n=t,(o=[{key:"activate",value:function(e,t){this.getImpl().activate(e,t),this.activated=!0}},{key:"deactivate",value:function(){this.getImpl().deactivate(),this.getImpl().highlightInteraction_=null}},{key:"equals",value:function(e){return e instanceof M.control.EditionHighlightGeometry}},{key:"setLayer",value:function(e){this.getImpl().layer_=e}}])&&V(n.prototype,o),r&&V(n,r),t}();function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Y(e,t){return!t||"object"!==K(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $(e){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var te=function(e){function t(e,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=Y(this,$(t).call(this,e,n))).map_=e,o.drawInteraction_=null,o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ee(e,t)}(t,e),n=t,(o=[{key:"createInteraction",value:function(e,t,n){console.log("Callback: ",e);var o=null,r=this.layer_.getType();null!=n&&(r=n.getType()),console.log("Creando Interaction de Draw con layerType: "+r);var i=this.getSimpleType(r);"Point"==r?o=new ol.style.Style({image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"withe"}),stroke:new ol.style.Stroke({color:[255,0,0],width:2})})}):"Polygon"==r&&(o=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:4,fill:new ol.style.Fill({color:"#ffcc33"})})})),this.drawInteraction_=new ol.interaction.Draw({type:i,style:o}),this.drawInteraction_.on("drawend",e,this),this.interactions_.push(this.drawInteraction_),console.log("Interactions: ",this.interactions_)}},{key:"getSimpleType",value:function(e){return"MultiPoint"===e||"Point"===e?"Point":"MultiPolygon"===e||"Polygon"===e?"Polygon":"MultiLineString"===e||"LineString"===e?"LineString":void 0}}])&&Q(n.prototype,o),r&&Q(n,r),t}(m);function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function re(e,t){return!t||"object"!==ne(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var le=function(e){function t(e,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(te)&&M.exception("La implementación usada no puede crear controles EditionInsertGeometry");var r=new te(e,n);return(o=re(this,ie(t).call(this,r,"editionInsertGeometry"))).name="editionInsertGeometry",o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(t,M.Control),n=t,(o=[{key:"activate",value:function(e,t,n){console.log("Activando el control de insertar geometrias..."),this.getImpl().activate(e,t,n),this.activated=!0}},{key:"equals",value:function(e){return e instanceof M.control.EditionInsertGeometry}},{key:"setLayer",value:function(e){this.getImpl().layer_=e}}])&&oe(n.prototype,o),r&&oe(n,r),t}();function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ue(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ce(e,t){return!t||"object"!==se(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,t){return(fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var de=function(e){function t(e,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=ce(this,ye(t).call(this,e,n))).map_=e,o.modifyInteraction_=null,o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fe(e,t)}(t,e),n=t,(o=[{key:"createInteraction",value:function(e,t){var n=this.layer_.getSelectedFeatureCollection(),o=new ol.style.Style({image:new ol.style.Circle({radius:4,fill:new ol.style.Fill({color:"#ffcc33"})})});this.modifyInteraction_=new ol.interaction.Modify({features:n,deleteCondition:function(e){return ol.events.condition.shiftKeyOnly(e)&&ol.events.condition.singleClick(e)},style:o}),this.modifyInteraction_.on("modifyend",e,this),this.interactions_.push(this.modifyInteraction_)}}])&&ue(n.prototype,o),r&&ue(n,r),t}(m);function pe(e){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function he(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ge(e,t){return!t||"object"!==pe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function me(e){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ve(e,t){return(ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var be=function(e){function t(e,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(de)&&M.exception("La implementación usada no puede crear controles EditionModifyGeometry");var r=new de(e,n);return(o=ge(this,me(t).call(this,r,"editionModifyGeometry"))).name="editionModifyGeometry",o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}(t,M.Control),n=t,(o=[{key:"activate",value:function(e,t){this.getImpl().activate(e,t),this.activated=!0}},{key:"equals",value:function(e){return e instanceof M.control.EditionModifyGeometry}},{key:"setLayer",value:function(e){this.getImpl().layer_=e}}])&&he(n.prototype,o),r&&he(n,r),t}();function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function we(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Se(e,t){return!t||"object"!==_e(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pe(e){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fe=function(e){function t(e,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=Se(this,Pe(t).call(this,e,n))).map_=e,o.drawInteraction_=null,o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(t,e),n=t,(o=[{key:"createInteraction",value:function(e,t){var n=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffa733",width:2}),image:new ol.style.Circle({radius:4,fill:new ol.style.Fill({color:"#ffcc33"})})});this.drawInteraction_=new ol.interaction.Draw({type:"Point"===t?"Point":"LineString"===t?"LineString":"Polygon",style:n}),this.drawInteraction_.on("drawend",e,this),this.interactions_.push(this.drawInteraction_)}}])&&we(n.prototype,o),r&&we(n,r),t}(m);function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ke(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Be(e,t){return!t||"object"!==Le(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xe(e){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ce=function(e){function t(e,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(Fe)&&M.exception("La implementación usada no puede crear controles EditionInsertLine");var r=new Fe(e,n);return(o=Be(this,xe(t).call(this,r,"editionInsertLine"))).name="editionInsertLine",o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(t,M.Control),n=t,(o=[{key:"activate",value:function(e,t,n){this.getImpl().activate(e,t,n),this.activated=!0}},{key:"equals",value:function(e){return e instanceof M.control.EditionTemporalGeometry}}])&&ke(n.prototype,o),r&&ke(n,r),t}();function Ee(e){return(Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function je(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ie(e,t){return!t||"object"!==Ee(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Te(e){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ge(e,t){return(Ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ne=function(e){function t(e,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=Ie(this,Te(t).call(this,e,n))).map_=e,o.snapInteraction_=null,o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ge(e,t)}(t,e),n=t,(o=[{key:"createInteraction",value:function(e,t){this.snapInteraction_=new ol.interaction.Snap({source:this.layer_.getImplLayer().getSource()}),this.interactions_.push(this.snapInteraction_)}}])&&je(n.prototype,o),r&&je(n,r),t}(m);function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ze(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ae(e,t){return!t||"object"!==De(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qe(e){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Re(e,t){return(Re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Je=function(e){function t(e,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(Ne)&&M.exception("La implementación usada no puede crear controles EditionSnapping");var r=new Ne(e,n);return(o=Ae(this,qe(t).call(this,r,"editionSnapping"))).name="editionSnapping",o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Re(e,t)}(t,M.Control),n=t,(o=[{key:"activate",value:function(e,t){this.getImpl().activate(e,t),this.activated=!0}},{key:"equals",value:function(e){return e instanceof M.control.EditionSnapping}},{key:"setLayer",value:function(e){this.getImpl().layer_=e}}])&&ze(n.prototype,o),r&&ze(n,r),t}();function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ve(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ue(e,t){return!t||"object"!==We(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ze(e,t,n){return(Ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=He(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function He(e){return(He=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xe(e,t){return(Xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ke=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ue(this,He(t).call(this))).map=e,n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xe(e,t)}(t,M.impl.Control),n=t,(o=[{key:"addTo",value:function(e,n){Ze(He(t.prototype),"addTo",this).call(this,e,n)}},{key:"getFeaturesFromGeoJson",value:function(e){return(new ol.format.GeoJSON).readFeatures(e)}},{key:"getGeoJsonFromFeature",value:function(e){return(new ol.format.GeoJSON).writeFeatureObject(e)}},{key:"getFeatureRequestBody",value:function(e,t){var n=new ol.geom.Point(t),o=this.map.getProjection().code;return(new ol.format.WFS).writeGetFeature({srsName:o,featurePrefix:e.featurePrefix,featureTypes:e.featureTypes,outputFormat:e.outputFormat,maxFeatures:e.maxFeatures,filter:ol.format.filter.intersects(e.geomField,n,o)})}},{key:"getBbox",value:function(e){for(var t=ol.extent.boundingExtent([e,e]),n=0;n<t.length;n++)2!=n&&3!=n||(t[n]=t[n]+1e-10);return t}},{key:"getModifyStyle",value:function(e){return[new ol.style.Style({fill:new ol.style.Fill({color:"rgba(239,245,3,0.25)"}),stroke:new ol.style.Stroke({width:3,color:"rgba(239,245,3, 0.8)"})}),new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"rgba(230,137,16, 0.8)"})}),geometry:function(t){var n=e.getGeometry().getCoordinates()[0];return"MultiPolygon"===e.getGeometry().getType()&&(n=e.getGeometry().getCoordinates()[0][0]),new ol.geom.MultiPoint(n)}})]}},{key:"createOLPolygonFeature",value:function(e){console.log("En createOLPolygonFeature, no tengo claro qué hace esto...");for(var t,n=e.getGeometry(),o=0;o<n.coordinates.length;o++){var r=n.coordinates[o];t=new M.Feature(Math.floor(1e6*Math.random()),{type:"Polygon",geometry:r,geometry_name:"geometry",properties:{}})}return t}}])&&Ve(n.prototype,o),r&&Ve(n,r),t}(),Qe=n(1),Ye=n.n(Qe),$e=function(e,t,n,o,r,i){console.log("ShowDialog: layers= ",i);var a=M.template.compileSync(Ye.a,{jsonp:!1,vars:{message:e,title:t,severity:n,layers:i}});tt(a,o,r)},et=function(){var e=document.querySelector("div.m-dialog");document.querySelector("div.m-mapea-container").removeChild(e)},tt=function(e,t,n){var o=document.querySelector("div.m-mapea-container"),r=e.querySelector("#m-edition-dialog-button-aceptar > button"),i=e.querySelector("#m-edition-dialog-button-cancelar > button");void 0===n?i.addEventListener("click",et,!1):i.addEventListener("click",n,!1);var a=e.querySelector(".m-layer-selection");a?r.addEventListener("click",(function(){t(a.value)}),!1):r.addEventListener("click",t,!1),o.appendChild(e)},nt=function(e){return(new jsts.io.GeoJSONWriter).write(e)},ot=function(e,t){var n=new M.Feature(e.getId(),e.getGeoJSON());return console.log("feature clonado:",n),n.setGeometry(rt(e.getGeometry(),t.getGeometry())),n},rt=function(e,t){var n=st(e),o=st(t),r=n.union(o);return nt(r)},it=function(e,t){console.log("intersects",e,t);var n=st(t),o=[];return e.forEach((function(e){console.log("analizando interseccion..."),st(e.getGeometry()).intersects(n)&&o.push(e)})),o},at=function(e,t){var n=st(e.getGeometry()),o=st(t.getGeometry()),r=n.intersection(o);return nt(r)},lt=function(e,t){var n=st(t.getGeometry()),o=st(e.getGeometry()).difference(n);return nt(o)},st=function(e){return console.log("En getJSTSGeometry:",e),(new jsts.io.GeoJSONReader).read(e)},ut=function(e,t){console.log("En dividePolygon");var n=st(t.getGeometry());void 0!==n._geometries&&(n=n._geometries[0]);var o=st(e.getGeometry());try{var r=n.getExteriorRing().union(o),i=new jsts.operation.polygonize.Polygonizer;i.add(r);var a=i.getPolygons(),l=a,s=null;if(a.size()<2)try{var u=t.getGeometry(),c=turf.polygonToLine(u);c.geometry.coordinates.push(e.getGeometry().coordinates);var y=turf.lineToPolygon(c);return s=turf.polygon([y.geometry.coordinates[y.geometry.coordinates.length-1]]),dt(s,t)}catch(e){return null}var f=n.getExteriorRing(),d=new jsts.operation.polygonize.Polygonizer;if(d.add(f),i.getGeometry().getArea()-d.getGeometry().getArea()>.1)return-1;if(n.getNumInteriorRing()>0){if(o.isSimple()){var p=yt(i,n);return ft(null,p,t)}return s=ct(n,o),ft(s,n,t)}return a.size()<2?null:pt(l,t)}catch(e){return}},ct=function(e,t){console.log("En getNewHolePolygon");var n=new jsts.operation.polygonize.Polygonizer,o=e.getExteriorRing().union(t);n.add(o);for(var r=n.getPolygons().iterator();r.hasNext();){var i=r.next();if(i._holes.length>0)return n.add(i._holes[0]),n.getPolygons().get(0)}return!1},yt=function(e,t){console.log("En getPolygonsOnHoles");for(var n=e.getPolygons(),o=new jsts.operation.polygonize.Polygonizer,r=n.get(0),i=null,a=0;a<t._holes.length;a++)o.add(t._holes[a]);var l=o.getPolygons();2===n.size()&&(i=n.get(1));for(var s=l.iterator();s.hasNext();){var u=s.next();r=r.difference(u),null!==i&&(i=i.difference(u))}var c=[];return c.push(r),null!==i&&c.push(i),c},ft=function(e,t,n){var o,r;console.log("En dividePolygonWithHolesJSTS");var i=[],a=1,l=[];if(null!==e){var s=n.getGeometry(),u=t.difference(e),c=e.intersection(t),y=nt(u),f=nt(c);if(null===y||null===f)return-1;s=y,e=f,l.push(s),l.push(e);for(var d=0;d<l.length;d++)r=new M.Feature(Math.random(),{type:"Feature",id:Math.random(),geometry:l[d],geometry_name:"geometry",properties:{}}),i.push(r),a+=a}else{l=t;for(var p=0;p<l.length;p++)o=nt(l[p]),r=new M.Feature(Math.random(),{type:"Feature",id:Math.random(),geometry:o,geometry_name:"geometry",properties:{}}),i.push(r),a++}return i},dt=function(e,t){console.log("En dividePolygonWithHoles");var n=[],o=1,r=[],i=t.getGeometry(),a=i;try{if(!turf.booleanContains(a,e)&&!turf.booleanOverlap(a,e))return-1;var l=st(i),s=st(e.geometry),u=l.difference(s),c=s.intersection(l),y=nt(u),f=nt(c);if(null===y||null===f)return-1;a.geometry=y,e.geometry=f,r.push(a),r.push(e)}catch(e){return-2}for(var d=0;d<r.length;d++){var p=new M.Feature(Math.random(),{type:"Feature",id:Math.random(),geometry:r[d],geometry_name:"geometry",properties:{}});n.push(p),o+=o}return n},pt=function(e,t){console.log("En createDividedPolygons");for(var n=[],o=1,r=e.iterator();r.hasNext();){var i=r.next(),a=nt(i),l=new M.Feature(Math.random(),t.getGeoJSON());l.setGeometry(a),n.push(l),o+=o}return n};function ht(e){return(ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function mt(e,t){return!t||"object"!==ht(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vt(e){return(vt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bt(e,t){return(bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _t=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(Ke)&&M.exception("La implementación usada no puede crear controles EditionGeometryControl");var o=new Ke(e.facadeMap_);return(n=mt(this,vt(t).call(this,o,"editionGeometryControl"))).NAME="editionGeometryControl",n.impl_=o,n.facadeMap_=e.facadeMap_,n.base=e,n.element_=e.element_,n.entityLayer_=e.sandBoxLayer_,n.insertGeomControl=n.base.insertGeomControl,n.insertTemporalGeomControl=n.base.insertTemporalGeomControl,n.modifyGeomControl=n.base.modifyGeomControl,n.translateGeomControl=n.base.translateGeomControl,n.selectGeomControl=n.base.selectGeomControl,n.snappingControl=n.base.snappingControl,n.highlightControl=n.base.highlightControl,n.entityAddWFSControl=null,n.insertPolygonButton=null,n.selectPolygonButton=null,n.selectPolygonByAreaButton=null,n.selectPolygonByLineButton=null,n.selectAllSandboxPolygonButton=null,n.modifyPolygonButton=null,n.dividePolygonButton=null,n.joinPolygonsButton=null,n.intersectPolygonButton=null,n.emptyPolygonButton=null,n.zoomToSelectedButton=null,n.addGeomButton=null,n.WFSManagerCtl=null,n.addEvents(),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bt(e,t)}(t,e),n=t,(o=[{key:"addEvents",value:function(){this.self_=this,this.snappingButton=this.element_.querySelector("#m-snapping-button"),this.snappingButton.addEventListener("click",this.activateSnapping.bind(this),!1),this.zoomMenuElement=this.element_.querySelector("#m-zoommenu-button"),this.zoomMenuPolygonButton=this.element_.querySelector("#m-zoom-button"),this.zoomMenuPolygonButtonClass=this.zoomMenuPolygonButton.classList.value,this.zoomMenuPolygonButton.addEventListener("click",this.manageSelectedClassInDropdown,!1),this.zoomMenuElement.addEventListener("mouseover",this.showDropdownContent,!1),this.zoomMenuElement.addEventListener("mouseout",this.hideDropdownContent,!1),this.zoomDropdownMenu=this.zoomMenuElement.querySelector("#myDropdown"),this.zoomToSandBoxButton=this.element_.querySelector("button#m-zoomsandbox-button"),this.zoomToSandBoxButton.addEventListener("click",this.zoomToSandBox.bind(this),!1),this.zoomToSelectedButton=this.element_.querySelector("button#m-zoomselect-button"),this.zoomToSelectedButton.addEventListener("click",this.zoomToSelection.bind(this),!1),this.selectMenuElement=this.element_.querySelector("#m-selectmenu-button"),this.selectMenuPolygonButton=this.element_.querySelector("#m-select-button"),this.selectMenuPolygonButtonClass=this.selectMenuPolygonButton.classList.value,this.selectMenuPolygonButton.addEventListener("click",this.manageSelectedClassInDropdown,!1),this.selectMenuElement.addEventListener("mouseover",this.showDropdownContent,!1),this.selectDropdownMenu=this.selectMenuElement.querySelector("#myDropdown"),this.selectMenuElement.addEventListener("mouseout",this.hideDropdownContent,!1),this.removeFromSandBoxButton=this.element_.querySelector("button#m-removefromsandbox-button"),this.removeFromSandBoxButton.addEventListener("click",this.removeSelectedFeaturesFromSandBox.bind(this),!1),this.selectPolygonButton=this.element_.querySelector("button#m-selectclick-button"),this.selectPolygonButton.addEventListener("click",this.selectPolygonByClick.bind(this),!1),this.selectPolygonByAreaButton=this.element_.querySelector("button#m-selectarea-button"),this.selectPolygonByAreaButton.addEventListener("click",this.selectPolygonByDraw.bind(this),!1),this.selectPolygonByLineButton=this.element_.querySelector("button#m-selectline-button"),this.selectPolygonByLineButton.addEventListener("click",this.selectPolygonByDraw.bind(this),!1),this.selectAllSandboxPolygonButton=this.element_.querySelector("button#m-selectall-button"),this.selectAllSandboxPolygonButton.addEventListener("click",this.selectAllSandboxPolygon.bind(this),!1),this.deselectAllSandboxPolygonButton=this.element_.querySelector("button#m-deselectall-button"),this.deselectAllSandboxPolygonButton.addEventListener("click",this.deselectAllSandboxPolygon.bind(this),!1),this.insertPolygonButton=this.element_.querySelector("button#m-draw-button"),this.insertPolygonButton.addEventListener("click",this.insertPolygon.bind(this),!1),this.modifyPolygonButton=this.element_.querySelector("button#m-modify-button"),this.modifyPolygonButton.addEventListener("click",this.modifyPolygon.bind(this),!1),this.dividePolygonButton=this.element_.getElementsByTagName("button")["m-splitpolygon-button"],this.dividePolygonButton.addEventListener("click",this.dividePolygon.bind(this),!1),this.joinPolygonsButton=this.element_.querySelector("button#m-unir-button"),this.joinPolygonsButton.addEventListener("click",this.confirmDialogJoinPolygons.bind(this),!1),this.addGeomButton=this.element_.querySelector("button#m-addgeometry-button"),this.addGeomButton.addEventListener("click",this.addGeom.bind(this),!1),this.intersectPolygonButton=this.element_.querySelector("button#m-intersect-button"),this.intersectPolygonButton.addEventListener("click",this.intersectPolygon.bind(this),!1),this.emptyPolygonButton=this.element_.querySelector("button#m-vaciado-button"),this.emptyPolygonButton.addEventListener("click",this.emptyPolygon.bind(this),!1)}},{key:"showDropdownContent",value:function(e){""!==e.currentTarget.children[1].style.width&&"0px"!==e.currentTarget.children[1].style.width||(e.currentTarget.children[0].style.float="left",e.currentTarget.children[1].style.left="40px","m-zoommenu-button"===e.currentTarget.id?e.currentTarget.children[1].style.width="80px":e.currentTarget.children[1].style.width="200px",e.currentTarget.children[1].style.borderTopRightRadius="4px",e.currentTarget.children[1].style.borderBottomRightRadius="4px",e.currentTarget.children[0].style.marginBottom="-4px")}},{key:"hideDropdownContent",value:function(e){e.currentTarget.children[1].style.width="0px"}},{key:"manageSelectedClassInDropdown",value:function(e){var t;"m-select-button"===e.currentTarget.id&&"g-cartografia-flecha"!==e.currentTarget.classList.value?"g-cartografia-flecha"===this.selectMenuPolygonButtonClass&&(t=this.selectMenuPolygonButtonClass,e.currentTarget.nextElementSibling.style.width="0px",e.currentTarget.classList.value=t,this.deactiveControls()):null!==e.currentTarget.offsetParent.previousElementSibling&&"m-zoom-button"!==e.currentTarget.offsetParent.previousElementSibling.id&&(t=e.currentTarget.classList.value,e.currentTarget.offsetParent.style.width="0px",e.currentTarget.offsetParent.previousElementSibling.classList.value=t)}},{key:"restoreDefaultClassDropdownButtons",value:function(){this.selectMenuPolygonButton.classList.value=this.selectMenuPolygonButtonClass}},{key:"removeSelectedFeaturesFromSandBox",value:function(e){if(this.entityLayer_.selectedFeatures_.length>0){var t=this.removeSelectedFeatures.bind(this);$e("Se eliminarán las geometrías seleccionadas ¿Desea continuar?","Eliminar geometrías","info",t)}else M.dialog.info("No hay geometrías seleccionadas","Eliminar geometrías")}},{key:"removeSelectedFeatures",value:function(){this.deactiveControls(),this.unselectControls(),this.entityLayer_.removeFeaturesFromSandBox(this.entityLayer_.selectedFeatures_),et()}},{key:"activateSnapping",value:function(e){e.currentTarget.className.indexOf("selected")<0?(e.currentTarget.className+=" selected",e.currentTarget.title="Desactivar snapping",this.snappingControl.activate(null,null)):(e.currentTarget.title="Activar snapping",e.currentTarget.className=this.snappingButton.className.replace(" selected",""),this.snappingControl.deactivate())}},{key:"insertPolygon",value:function(e){if(this.restoreDefaultClassDropdownButtons(),this.deactiveControls(),e.currentTarget.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.className+=" selected";var t=this.onPolygonInserted.bind(this);this.insertGeomControl.activate(t),this.snappingControl.deactivate(),this.snappingButton.className.indexOf("selected")>0&&this.snappingControl.activate(null,null)}else this.unselectControls()}},{key:"onPolygonInserted",value:function(e){console.log("onPolygonInserted"),this.entityLayer_.addNewFeatureToSandBox(e.feature)}},{key:"selectPolygonByClick",value:function(e){if(this.manageSelectedClassInDropdown(e),this.deactiveControls(),e.currentTarget.offsetParent.previousElementSibling.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.offsetParent.previousElementSibling.className+=" selected";var t=this.onPolygonSelected.bind(this);this.selectGeomControl.activate(t)}else this.showDropdownContent()}},{key:"onPolygonSelected",value:function(e){var t=this,n=null;if(e.selected.length>0){if(this.entityLayer_.getFeatures().forEach((function(o,r,i){for(var a=0;a<e.selected.length;a++)e.selected[a].getId()===t.entityLayer_.getImplFeature(o).getId()&&(n=e.selected[a])})),null!==n){var o=null;this.entityLayer_.selectedFeatures_.forEach((function(n,r,i){for(var a=0;a<e.selected.length;a++)e.selected[a].getId()===t.entityLayer_.getImplFeature(n).getId()&&(o=e.selected[a])})),null===o?this.entityLayer_.selectFeature(n):this.entityLayer_.unselectFeature(n)}e.target.getFeatures().clear()}}},{key:"selectPolygonByDraw",value:function(e){this.manageSelectedClassInDropdown(e);var t="m-selectarea-button"===e.currentTarget.id?"Polygon":"LineString";if(this.deactiveControls(),e.currentTarget.offsetParent.previousElementSibling.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.offsetParent.previousElementSibling.className+=" selected";var n=this.onPolygonSelectedByDraw.bind(this);this.insertTemporalGeomControl.activate(n,t)}else this.showDropdownContent()}},{key:"onPolygonSelectedByDraw",value:function(e){for(var t=this.entityLayer_.getFeatures(),n=it(t,this.impl_.getGeoJsonFromFeature(e.feature).geometry),o=0;o<n.length;o++){var r=null;if(t.forEach((function(e,t,i){n[o].getId()===e.getId()&&(r=n[o])})),null!==r){var i=null;this.entityLayer_.selectedFeatures_.forEach((function(e,t,r){n[o].getId()===e.getId()&&(i=n[o])})),null===i?this.entityLayer_.selectFeature(r):this.entityLayer_.unselectFeature(r)}}}},{key:"selectAllSandboxPolygon",value:function(){this.entityLayer_.getFeatures().length>0?(this.deactiveControls(),this.unselectControls(),this.entityLayer_.selectAllFeatures()):M.dialog.info("No hay geometrías en la capa de trabajo")}},{key:"deselectAllSandboxPolygon",value:function(){this.entityLayer_.selectedFeatures_.length>0?(this.deactiveControls(),this.unselectControls(),this.entityLayer_.unselectAllFeatures()):M.dialog.info("No hay geometrías seleccionadas en la capa de trabajo")}},{key:"modifyPolygon",value:function(e){if(this.entityLayer_.selectedFeatures_.length>0)if(this.restoreDefaultClassDropdownButtons(),this.deactiveControls(),e.currentTarget.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.className+=" selected";for(var t=this.entityLayer_.selectedFeatures_,n=0;n<t.length;n++){var o=this.impl_.getModifyStyle(this.entityLayer_.getImplFeature(t[n]));this.entityLayer_.getImplFeature(t[n]).setStyle(o)}var r=this.onPolygonModified.bind(this);this.modifyGeomControl.activate(r),this.snappingControl.deactivate(),this.snappingButton.className.indexOf("selected")>0&&this.snappingControl.activate(null,null)}else this.unselectControls();else M.dialog.info("No hay geometrías seleccionadas en la capa de trabajo")}},{key:"onPolygonModified",value:function(e){for(var t=e.features.getArray(),n=0;n<t.length;n++)t[n].getRevision()>1&&t[n]}},{key:"dividePolygon",value:function(e){if(this.restoreDefaultClassDropdownButtons(),this.deactiveControls(),e.currentTarget.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.className+=" selected";var t=this.onPolygonDivided.bind(this);this.insertTemporalGeomControl.activate(t,"LineString"),document.body.style.cursor="pointer"}else this.unselectControls()}},{key:"onPolygonDivided",value:function(e){var t,n=this.entityLayer_.selectedFeatures_,o=[];if(n.length>0){var r=new M.Feature(Math.floor(1e6*Math.random()),this.impl_.getGeoJsonFromFeature(e.feature));t=it(n,r.getGeometry());for(var i=0;i<t.length;i++)o.push(ut(r,t[i]));for(var a=!1,l=0;l<o.length;l++)0!==o[l]&&-1!==o[l]&&-2!==o[l]&&void 0!==o[l]&&null!==o[l]||(a=!0);if(a)M.dialog.info("La geometría no es válida","Dividir geometría");else{for(var s=0;s<o.length;s++)this.entityLayer_.addFeatures(o[s]);this.entityLayer_.removeFeaturesFromSandBox(t)}}else M.dialog.info("Debe seleccionar al menos una geometría","Dividir geometría")}},{key:"confirmDialogJoinPolygons",value:function(e){if(this.entityLayer_.selectedFeatures_.length>1){var t=this.joinPolygons.bind(this);$e("Se agruparán las geometrías seleccionadas ¿Desea continuar?","Agrupar geometrías","info",t)}else M.dialog.info("Debe seleccionar al menos dos geometrías","Agrupar geometrías")}},{key:"joinPolygons",value:function(){var e,t,n=this.entityLayer_.selectedFeatures_,o=[],r=[],i=[];this.restoreDefaultClassDropdownButtons(),et();for(var a=0;a<n.length;a++){var l=new M.Feature(n[a].getId(),{type:"Feature",geometry:n[a].getGeometry(),geometry_name:"geometry",properties:{}});i.push(l)}if(n.length>0){this.deactiveControls(),this.unselectControls();for(var s=0;s<n.length;s++){e=n[s];for(var u=0;u<i.length;u++){o.push(e);var c=st(e.getGeometry()),y=st(i[u].getGeometry());if(!0===c.intersects(y)&&!1===e.equals(i[u])){r.push(this.entityLayer_.getImplFeature(e)),o.push(i[u]),(t=ot(o[0],o[1])).setId(Math.floor(1e6*Math.random())),o=[],this.entityLayer_.addNewMFeatureToSandBox(t),r.push(i[u]),this.entityLayer_.removeFeaturesFromSandBox(r);for(var f=0;f<r.length;f++){var d=i.indexOf(r[f]);d>-1&&i.splice(d,1)}var p=t.getGeoJSON();e=new M.Feature(t.getId(),p),u=0,s=0}else o=[]}}}else M.dialog.info("Debe seleccionar al menos dos geometrías")}},{key:"intersectPolygon",value:function(e){if(this.restoreDefaultClassDropdownButtons(),0!==this.entityLayer_.selectedFeatures_.length)if(this.deactiveControls(),e.currentTarget.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.className+=" selected",document.body.style.cursor="pointer";var t=this.onPolygonIntersected.bind(this);this.selectGeomControl.activate(t),this.highlightControl.activate()}else this.highlightControl.deactivate(),this.unselectControls();else M.dialog.info("No hay geometrías seleccionadas","Intersección")}},{key:"onPolygonIntersected",value:function(e){var t,n;if(console.log("onPolygonIntersected",e),(n=this.entityLayer_.selectedFeatures_).length>0&&(t=it(n,this.entityLayer_.getMFeatureById(e.selected[0].getId()).getGeometry())).length>0){var o=[];o.push(t),o.push(this.entityLayer_.getMFeatureById(e.selected[0].getId())),this.doSpatialProcess(at,o),this.clear()}}},{key:"emptyPolygon",value:function(e){if(this.restoreDefaultClassDropdownButtons(),0!==this.entityLayer_.selectedFeatures_.length)if(this.deactiveControls(),e.currentTarget.className.indexOf("selected")<0){this.unselectControls(),e.currentTarget.className+=" selected",document.body.style.cursor="pointer";var t=this.onGeometryEmptied.bind(this);this.selectGeomControl.activate(t),this.highlightControl.activate()}else this.highlightControl.deactivate(),this.unselectControls();else M.dialog.info("No hay geometrías seleccionadas","Vaciado")}},{key:"onGeometryEmptied",value:function(e){var t=this.entityLayer_.selectedFeatures_;if(t.length>0){var n=[];n.push(t),n.push(this.entityLayer_.getMFeatureById(e.selected[0].getId())),this.doSpatialProcess(lt,n),this.clear()}}},{key:"doSpatialProcess",value:function(e,t){console.log("doSpatialProcess...");for(var n=t[0],o=t[1],r=0;r<n.length;r++){var i=n[r];if(o!==i){var a=e.apply(this,[i,o]),l=new M.Feature(Math.floor(1e6*Math.random())+1,{type:"Feature",geometry:a,geometry_name:"geometry",properties:{}});if("MultiPolygon"===l.getGeometry().type){console.log("Es MultiPolygon");var s=this.impl_.createOLPolygonFeature(l);this.entityLayer_.addNewMFeatureToSandBox(s)}else this.entityLayer_.addNewMFeatureToSandBox(l)}(n.length>1||1===n.length&&o!==i)&&this.entityLayer_.removeFeaturesFromSandBox([i])}}},{key:"addGeom",value:function(e){console.log("addGeom");var t=[];this.facadeMap_.getLayers().forEach((function(e){e instanceof M.layer.Vector&&"editionLayer"!=e.name&&e.getFeatures().length>0&&t.push(e)}));var n=this.addGeomFromVectorialLayer.bind(this);$e("Se añadirán las geometrías de la capa seleccionada ¿Desea continuar?","Copiar geometrías","info",n,void 0,t)}},{key:"addGeomFromVectorialLayer",value:function(e){var t=this,n=this.facadeMap_.getLayers({name:e})[0];this.entityLayer_.removeAllFeatures();var o=n.getFeatures()[0].getGeometry().type;console.log("La geometria de la capa es: "+o),this.entityLayer_.setType(o),n.getFeatures().forEach((function(e){var n=e.getGeoJSON(),o=new M.Feature(e.getId(),n);t.entityLayer_.addNewMFeatureToSandBox(o)})),et()}},{key:"checkWFSManagerPlugin",value:function(){var e=this.facadeMap_.getPanels("Catalog")[0].getControls()[0];if(e){for(var t=0;t<e.controls_.length;t++)"WFSManagerControl"===e.controls_[t].name&&(this.WFSManagerCtl=e.controls_[t]);return null!==this.WFSManagerCtl}return!1}},{key:"zoomToSandBox",value:function(e){this.manageSelectedClassInDropdown(e),this.entityLayer_.getFeatures().length>0?this.entityLayer_.zoomToFeatures(this.entityLayer_.getFeatures()):M.dialog.info("No hay geometrías en la capa de trabajo","Zoom a la capa de trabajo")}},{key:"zoomToSelection",value:function(e){this.manageSelectedClassInDropdown(e),this.entityLayer_.selectedFeatures_.length>0?this.entityLayer_.zoomToFeatures(this.entityLayer_.selectedFeatures_):M.dialog.info("No hay geometrías seleccionadas","Zoom a la selección")}},{key:"getWfsFeatures",value:function(e){var t=this;e.preventDefault();var n=document.getElementsByClassName("m-mapea-container")[0];M.EditionSpinner.show(n);var o=this.WFSManagerCtl.getServiceActive(),r=this.impl_.getFeatureRequestBody(o,e.coordinate),i={jsonp:o.useProxy},a=(new XMLSerializer).serializeToString(r);M.proxy(o.useProxy),M.remote.post(o.url,a,i).then((function(e){if(M.proxy(!0),200===e.code)return Number(e.xml.documentElement.getAttribute("numberOfFeatures"))<1?(M.EditionSpinner.close(n),void M.dialog.info("No se han encontrado "+o.description)):e.text;M.dialog.error("No se ha podido realizar la consulta")})).then((function(e){var r=t.entityLayer_.readGML3Features(e);if(r.length>0){for(var i=0;i<r.length;i++)t.entityLayer_.addNewFeatureToSandBox(r[i]);M.EditionSpinner.close(n)}else M.EditionSpinner.close(n),M.dialog.info("No se han encontrado "+o.description)})).catch((function(e){M.EditionSpinner.close(n),M.dialog.error("No se ha podido realizar la consulta")}))}},{key:"deactiveControls",value:function(){this.insertGeomControl.deactivate(),this.insertTemporalGeomControl.deactivate(),this.modifyGeomControl.deactivate(),this.selectGeomControl.deactivate(),this.snappingControl.deactivate(),this.highlightControl.deactivate(),this.facadeMap_.getMapImpl().un("click",this.getWfsFeatures,this)}},{key:"unselectControls",value:function(){this.insertPolygonButton.className=this.insertPolygonButton.className.replace(" selected",""),this.addGeomButton.className=this.addGeomButton.className.replace(" selected",""),this.selectPolygonButton.className=this.selectPolygonButton.className.replace(" selected",""),this.selectPolygonByLineButton.className=this.selectPolygonByLineButton.className.replace(" selected",""),this.selectPolygonByAreaButton.className=this.selectPolygonByAreaButton.className.replace(" selected",""),this.modifyPolygonButton.className=this.modifyPolygonButton.className.replace(" selected",""),this.dividePolygonButton.className=this.dividePolygonButton.className.replace(" selected",""),this.intersectPolygonButton.className=this.intersectPolygonButton.className.replace(" selected",""),this.emptyPolygonButton.className=this.emptyPolygonButton.className.replace(" selected",""),this.removeFromSandBoxButton.className=this.removeFromSandBoxButton.className.replace(" selected","");for(var e=this.entityLayer_.selectedFeatures_,t=0;t<e.length;t++)e[t].getImpl().getOLFeature().setStyle(this.entityLayer_.getSelectedStyle());document.body.style.cursor="default"}},{key:"clear",value:function(){this.unselectControls(),this.deactiveControls()}},{key:"equals",value:function(e){var t=!1;return e instanceof M.control.EditionGeometryControl&&(t=this.name===e.name),t}},{key:"destroy",value:function(){this.getImpl().destroy()}}])&&gt(n.prototype,o),r&&gt(n,r),t}(Ke);function wt(e){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function St(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Pt(e,t){return!t||"object"!==wt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ot(e,t,n){return(Ot="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ft(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function Ft(e){return(Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Lt(e,t){return(Lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var kt=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(N)&&M.exception("La implementación usada no puede crear controles editionControl");var n=new N;return(e=Pt(this,Ft(t).call(this,n,"edition"))).sandBoxLayer_=null,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lt(e,t)}(t,M.Control),n=t,(o=[{key:"createView",value:function(e){var t=this,n=this;return this.facadeMap_=e,new Promise((function(o,i){var a=M.template.compileSync(r.a);n.element_=a,n.sandBoxLayer_=new c(t),n.createControls(),n.addEvents(e,a),o(a)}))}},{key:"createControls",value:function(){console.log("Creando controles..."),this.highlightControl=new X(this.facadeMap_,this.sandBoxLayer_),this.insertGeomControl=new le(this.facadeMap_,this.sandBoxLayer_),this.modifyGeomControl=new be(this.facadeMap_,this.sandBoxLayer_),this.insertTemporalGeomControl=new Ce(this.facadeMap_,this.sandBoxLayer_),this.snappingControl=new Je(this.facadeMap_,this.sandBoxLayer_),this.selectGeomControl=new x(this.facadeMap_,this.sandBoxLayer_),this.geomControl=new _t(this)}},{key:"addEvents",value:function(e,t){console.log("Añadiendo eventos...")}},{key:"activate",value:function(){Ot(Ft(t.prototype),"activate",this).call(this)}},{key:"deactivate",value:function(){Ot(Ft(t.prototype),"deactivate",this).call(this),this.getImpl().deactivateClick(this.map_)}},{key:"getActivationButton",value:function(e){return e.querySelector(".m-edition button")}},{key:"destroyControls",value:function(){this.geomControl.clear(),this.sandBoxLayer_.destroy()}},{key:"equals",value:function(e){return e instanceof t}}])&&St(n.prototype,o),i&&St(n,i),t}(),Bt=n(2);function xt(e){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mt(e,t){return!t||"object"!==xt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ct(e){return(Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Et(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function jt(e,t,n){return t&&Et(e.prototype,t),n&&Et(e,n),e}function It(e,t){return(It=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tt=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Mt(this,Ct(t).call(this))).map_=null,e.controls_=[],e.position="TL",e.metadata_=Bt.metadata,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&It(e,t)}(t,M.Plugin),jt(t,null,[{key:"NAME",get:function(){return"edition"}}]),jt(t,[{key:"addTo",value:function(e){this.control_=new kt,this.controls_.push(this.control_),this.map_=e,this.panel_=new M.ui.Panel("paneledition",{collapsible:!0,className:"m-edition",collapsedButtonClass:"g-editiontools-closed",openedButtonClass:"g-editiontools-opened-vertical",position:M.ui.position[this.position],tooltip:"Herramientas de edición"}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_)}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"getAPIRest",value:function(){return"".concat(this.name,"=").concat(this.position)}},{key:"destroy",value:function(){this.control_.destroyControls(),this.map_.removeControls([this.control_]),this.map_=null,this.control_=null,this.panel_=null}},{key:"equals",value:function(e){return e instanceof t}},{key:"name",get:function(){return"edition"}}]),t}();window.M.plugin||(window.M.plugin={}),window.M.plugin.Edition=Tt}]);
//# sourceMappingURL=edition.ol.min.js.map